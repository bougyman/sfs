.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.14
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "NEWAID 1"
.TH NEWAID 1 "2004-10-16" "SFS 0.8pre" "SFS 0.8pre"
.SH "NAME"
newaid \- Run processes with different sfsagents
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
newaid [\-l] [\-{u|U} \fIuid\fR] [\-G | \-g \fIgid\fR] [\-C \fIdir\fR] [\fIprogram\fR \fIarg\fR ...]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The \fBnewaid\fR command allows root-owned processes to access \s-1SFS\s0
file systems using the \fBsfsagent\fR of a non-root user.
Additionally, if a system is configured to allow this,
\&\fBnewaid\fR permits non-root users to run multiple
\&\fBsfsagent\fR processes, so that different processes owned by
that user access the \s-1SFS\s0 file system with different agents.  (When
used in The latter mode, \fBnewaid\fR is similar in function to
the \s-1AFS\s0 program \fBpagsh\fR.)
.PP
\&\s-1SFS\s0 maps file system requests to particular \fBsfsagent\fR
processes using the notion of agent \s-1ID\s0, or \fBaid\fR.  Every process
has a 64\-bit aid associated with it.  Ordinarily, a process's aid is
simply its 32\-bit user \s-1ID\s0.  Thus, when a user runs \fBsfsagent\fR,
both the agent and all of the users' processes have the same aid.
.PP
To allow different processes owned by the same user to have different
agents, a system administrator can reserve a range of group IDs for
the purpose of flagging different aids.
See the ResvGids directive described in the \fIsfs_config\fR man
page for a description of how to do this.
(Note that after changing \fBResvGids\fR, you must kill and restart
\&\fBsfscd\fR for things to work properly.)  If the range of
reserved group IDs is \fImin\fR...\fImax\fR, and the \fIfirst\fR
element of a process's grouplist, \fIg0\fR, is at least \fImin\fR and
not more than \fImax\fR, then a process's aid is computed as
((\fIg0\fR \- \fImin\fR + 1) << 32) | \fIuid\fR).  The \fBnewaid\fR
command therefore lets people insert any of the reserved group IDs at
the start of a process's group list.
.PP
For root-owned processes, it is also possible for processes to be
associated with a non-root agent.  In this case, the reserved
\&\fIsfs-group\fR (as a marker) and target user's uid are actually
placed in the process's grouplist, as well as any reserved group \s-1ID\s0 to
select amongst multiple agents of the same user.
.PP
After making appropriate changes to its user \s-1ID\s0 and/or grouplists,
\&\fBnewaid\fR executes the \fIprogram\fR specified on the command
line.  If no \fIprogram\fR is specified, the program specified by the
environment variable \fB\s-1SHELL\s0\fR is used by default.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\-l" 4
.IX Item "-l"
Run the command as a login shell.  This argument simply prepends a
\&\fB\-\fR character to \fBargv[0]\fR when executing \fIprogram\fR.
Command shells interpret this to mean that they are being being run as
login shells, and usually exhibit slightly different behavior.  (For
example \fBcsh\fR will execute the commands in a user's
\&\fI.login\fR file.)
.IP "\-u \fIuid\fR" 4
.IX Item "-u uid"
For root-owned process, specifies that the \fIprogram\fR should be run
as root, but should be associated with the non-root agent of user
\&\fIuid\fR.
.IP "\-U \fIuid\fR" 4
.IX Item "-U uid"
When \fBnewaid\fR is invoked by a root-owned processes, this
option sets the real uid to \fIuid\fR to run \fIprogram\fR, instead of
running it with uid 0.  This is in itself is not sufficient to ``drop
privileges.''  In particular, \fBnewaid\fR still does not make any
changes to the process gid or grouplist, beyond manipulating
aid-specific groups.  Since many root-owned processes also have
privileged groups in their grouplist, it is in general
\&\fBinsecure\fR to use \fB\-U\fR unless you set both the gid and
the whole grouplist to something sensible (i.e., appropriately
unprivileged) before invoking \fBnewaid\fR.
.Sp
This option is mostly of use for \fBlogin\fR\-like programs that
wish to create a session with a new aid, and do not wish to make the
\&\fBsetuid\fR system call themselves.  As an example, the
\&\fBrexd\fR daemon has the server's private key, yet must spawn the
\&\fBproxy\fR program as an unprivileged user.  If it dropped
privileges before executing \fBproxy\fR, unprivileged users could
send it signals, risking core dumps.  Moreover, attackers might be
able to exploit weaknesses in the operating system's \fBptrace\fR
system call or \fI/proc\fR file system to learn the private key.
\&\fBrexd\fR therefore runs \fBproxy\fR through
\&\fBnewaid\fR, giving it the \fB\-U\fR option.
.IP "\-g \fIgid\fR" 4
.IX Item "-g gid"
.PD 0
.IP "\-G" 4
.IX Item "-G"
.PD
By default \fBnewaid\fR simply picks the first aid under which no
agent is yet running.  The \fB\-g\fR option explicitly specifies
that \fIgid\fR should be added to the start of the process's group
list (and any previous reserved gid should be removed).  \fB\-G\fR
says to remove any reserved gid, so that the aid of the resulting
process will just be the user's uid.
.IP "\-C \fIdir\fR" 4
.IX Item "-C dir"
Changes directory to \fIdir\fR before running \fIprogram\fR.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIdirsearch\fR\|(1), \fIrex\fR\|(1), \fIsfsagent\fR\|(1), \fIsfskey\fR\|(1), \fIssu\fR\|(1), \fIsfs_config\fR\|(5), \fIsfs_hosts\fR\|(5), \fIsfs_srp_params\fR\|(5), \fIsfs_users\fR\|(5), \fIsfsauthd_config\fR\|(5), \fIsfscd_config\fR\|(5), \fIsfsrosd_config\fR\|(5), \fIsfsrwsd_config\fR\|(5), \fIsfssd_config\fR\|(5), \fIsfs_environ\fR\|(7), \fIfunmount\fR\|(8), \fInfsmounter\fR\|(8), \fIsfsauthd\fR\|(8), \fIsfscd\fR\|(8), \fIsfsrosd\fR\|(8), \fIsfsrwcd\fR\|(8), \fIsfsrwsd\fR\|(8), \fIsfssd\fR\|(8), \fIvidb\fR\|(8)
.PP
The full documentation for \fB\s-1SFS\s0\fR is maintained as a Texinfo
manual.  If the \fBinfo\fR and \fB\s-1SFS\s0\fR programs are properly installed
at your site, the command \fBinfo \s-1SFS\s0\fR
should give you access to the complete manual.
.PP
For updates, documentation, and software distribution, please
see the \fB\s-1SFS\s0\fR website at \fIhttp://www.fs.net/\fR.
.SH "AUTHOR"
.IX Header "AUTHOR"
sfsdev@redlab.lcs.mit.edu
